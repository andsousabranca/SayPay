<%# CONTAINER %>
<div class="p-6 flex flex-col items-center" data-controller="recording">

  <%# BACK BUTTON %>
  <div class="w-full flex items-center mb-4">
    <%= link_to trips_path, class: "flex items-center text-[#06231B]/60 hover:text-[#06231B]" do %>
      <i data-lucide="arrow-left" class="w-5 h-5 mr-1"></i>
      <span class="text-sm">Back to trips</span>
    <% end %>
  </div>

  <%# TRIP CARD (photo + info combined) %>
<div class="w-full bg-white rounded-2xl shadow-md overflow-hidden mb-10">

  <%# Trip Photo %>
  <%= image_tag @trip.url,
        class: "w-full h-44 object-cover" %>

  <%# Trip Info %>
  <div class="p-4">
    <h2 class="text-xl font-semibold text-[#06231B]">
      <%= @trip.country %>
    </h2>

    <p class="text-sm text-[#06231B]/60 mt-1">
      22nd November to 30th November
    </p>

    <p class="text-sm text-[#06231B]/60 mt-1">
      Total spent:
      <span class="font-semibold text-[#06231B]">â‚¬1000</span>
    </p>
  </div>

</div>

  <%# MAIN ACTION CTA %>
  <div class="flex flex-col items-center mt-2">

    <button type="button"
      id="start-recording"
      class="w-32 h-32 bg-[#21A179] text-white rounded-full shadow-lg flex items-center justify-center transition active:scale-95"
      data-recording-target="startRecording"
      data-action="click->recording#start">

      <i data-lucide="mic" class="w-12 h-12"></i>
    </button>

    <p class="text-sm text-[#06231B]/70 mt-5">
      Tap to start recording
    </p>
  </div>

  <%# STOP BUTTON (hidden until recording) %>
  <button type="button"
    id="stop-recording"
    class="mt-8 w-48 bg-gray-400 text-white py-3 rounded-full hidden"
    data-recording-target="stopRecording"
    data-action="click->recording#stop"
    disabled>
    Stop & Save
  </button>

  <%# RECORDING STATUS %>
  <div id="recording-status"
    class="mt-4 text-[#06231B]/80 text-sm hidden flex items-center gap-2"
    aria-live="polite"
    data-recording-target="recordingStatus">

    <span id="recording-dot"
      class="w-3 h-3 rounded-full bg-red-600 animate-pulse hidden"
      data-recording-target="recordingDot">
    </span>

    <span id="recording-message" data-recording-target="recordingMessage"></span>
  </div>

  <%# HIDDEN FIELDS %>
  <%= form_with model: [@trip, @expense], 
    data: { recording_target: "form" }, 
    id: "recording-form", 
    local: true, 
    html: { multipart: true } do |f| %>

    <%= f.hidden_field :trip_id, value: @trip.id %>

    <%= f.file_field :audio,
      id: "expense_audio",
      data: { recording_target: "fileInput" },
      accept: "audio/*",
      class: "hidden" %>

  <% end %>

</div>
